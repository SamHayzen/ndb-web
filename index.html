<html>
	<head>
		<title> Wiki Web Interface </title>
		 <meta name="description" content="Browser-based galactic internet browser" />
		 <meta property="og:title" content="NDB Wiki" />
		 <meta property="og:description" content="Browser-based galactic internet browser" />
		 <meta property="og:url" content="https://samhayzen.github.io/ndb-web/" />
		<script src="./highlight.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script>
			const defaultDomain = "https://samhayzen.github.io/ndb-web/"
			var domain = defaultDomain;
			var linkDomain = domain;
			var pushDate = "2/8/2022";
			//console.log(encodeURIComponent("https://echodolls.com/lore/"));
			var web;
			$.ajax({
			  type: "GET",
			  async: false,
			  url: domain+"web.json", // Using our resources.json file to serve results
			  success: function(result) {
				console.log(result);
				web = result;
			  }
			});
			const urlParams = new URLSearchParams(window.location.search);
			
		</script>
		<style>
			body {
				background-color: #000000;
			}
			p {
				font-family: monospace;
			}
			#theMainBox {
				width: 100% !important;
				height: 87% !important;
			}
			#webOutput {
				height: 75% !important;
				transition: opacity 2s ease-in;
			}
			.redText {
				color: #cb4b16;
			}
		</style>
		<link rel="stylesheet" href="./styles/solarized-dark.css">
	</head>
	<body id="Body">
		<div id="overBox" style="max-width: 800px; margin-right:auto; 	margin-left:auto;">
			<div id="theMainBox">
				<p class="redText"> <a id="backButton"> [<- Back] </a> <a id="cdDownButton"> [cd ..] </a><span id="TEXTButtons"><a id="prevButton"> [< Prev Page] </a><a id="nextButton"> [Next Page >] </a></a></p>
				<pre style="white-space: pre-wrap"><code id="webOutput" class="css">
	Loading...
				</code></pre>
				 <p class="redText"> <input type="text" placeholder="Type Commands Here" style="width: 75%;" id="inCommand"> <a id="helpButton"> [Click me for Info!] </a></p>
				 <p class="redText"> <a style="color: #859900"> Shortcuts</a><a style="color: #839496">:</a><a id="tutorialButton"> [Tutorial] </a><a id="wikiButton"> [The Wiki -- Netpedia] </a><a id="searchButton"> [Wiki Search] </a><a style="color: #839496"><a style="color: #839496"> --</a><a id="linkButton"> [Get a shareable link to this page] </a>
				 <p class="redText"></a><a style="color: #859900" id="entryNum"> current wiki entries </a><a id="randomButton">[Take me to a random entry!]</a></p>
			 </div>
		     <div style="">
				<p class="redText" style="padding-top: 5%"> <a id="dateInput" style="color: #859900"></a><a id="discordButton">[On our Discord!] </a></p>
			 </div>
		</div>
		<script>
			$(document).ready(function(){
				var commandInIsBeingTypedIn = false;
				var currentExtension = "";
				const months = ["CopperFlame","Crystone","Deriz","Bloom","Lereai","HarvestCrest","Karmil","SteelFell","Lunakin","SiltCrest","TinBell","Etherglide","Crimson","Apofel"];
				
				$("#dateInput").html(" This wiki image was last pushed "+pushDate+".  If severely out of date, ask @Sam Hayzen ");
				
				function copy(text) {
					var input = document.createElement('input');
					input.setAttribute('value', text);
					document.body.appendChild(input);
					input.select();
					var result = document.execCommand('copy');
					document.body.removeChild(input);
					return result;
				} //thank you, https://stackoverflow.com/questions/400212
				
				function doUserIn(){
					var holdval = document.getElementById("inCommand").value;
					document.getElementById("inCommand").value="";
					runCommand(holdval);
				}
				var inputSpace = document.getElementById("inCommand");
				inputSpace.addEventListener("keyup", function(event) {
					if (event.keyCode === 13) {
						event.preventDefault();
						doUserIn();
					}
				});
				
				$("#inCommand").focusin(function() {
					commandInIsBeingTypedIn = true;
				});
				
				$("#inCommand").focusout(function() {
					commandInIsBeingTypedIn = false;
				});
				
				
				$(document).keypress(function(e) {
					if(commandInIsBeingTypedIn) return;
					var hold = e.which;
					console.log(hold);
					if(hold == 48) hold+=10;
					if(hold>48&&hold<=58) runCommand("!"+(hold-48));
					switch(hold){
						case 96:
							runCommand("back");
						return;
						case 45:
							runCommand("cd ..");
						return;
						case 44:
							runCommand("prev");
						return;
						case 46:
							runCommand("next");
						return;
					}
				});
				
				var thisUser = {
					sitestr:"NX.HELP",
					pagestr:"/POINTER_MAIN",
					addressStack:[],
					siteStack:[],
					site:0,
					page:0,
					webvars:{}
				};
				
				$("#backButton").on("click",function(){runCommand("back");});
				$("#cdDownButton").on("click",function(){runCommand("cd ..");});
				$("#prevButton").on("click",function(){runCommand("prev");});
				$("#nextButton").on("click",function(){runCommand("next");});
				$("#tutorialButton").on("click",function(){runCommand("cd NX.HELP:/POINTER_MAIN");});;
				$("#wikiButton").on("click",function(){runCommand("cd EQ.NETPEDIA");});
				$("#searchButton").on("click",function(){runCommand("cd EQ.NETPEDIA:/SEARCH");});
				$("#discordButton").on("click",function(){
					var win = window.open('https://discord.gg/QUdqDK6', '_blank');
					if (win) {
						win.focus();
					} else {
						alert('Please allow popups for this website');
					}
				});
				$("#randomButton").on("click",function(){
					var holdsite = getSite("EQ.NETPEDIA");
					while(true){
						var randPageNum = Math.floor(Math.random()*web[holdsite].pages.length);
						var hold = web[holdsite].pages[randPageNum].data.indexOf("[!1]");
						if(hold>16||hold==-1&&web[holdsite].pages[randPageNum].data.length>16){
							runCommand("cd EQ.NETPEDIA:"+web[holdsite].pages[randPageNum].path);
							break;
						}
					}
				});
				$("#helpButton").on("click",function(){
					reply2("\n\n    Hello!  This is the web portal for the simulated interplanetary internet of the Asmodea galaxy!  Now, that may sound like a lot.  Basically, Asmodea is the fictional galaxy of our open, comminity-driven worldbuilding project called [Nth-Dimensional Borders].\n\n    Within this galaxy, Asmodea, there are a multitude of civilizations, peoples, and sentient species, each of which with their own origins and stories.  On this internet is our cannonical encyclopedia, called [Netpedia], which stores almost all defined information in our lore!\n\n    We have been working on this project for four years, with the galactic internet (which includes the wiki, Netpedia) existing for three of them.\n\n    If you see any gaps in this wiki that need filling, or you notice any problems in our wiki, please let us know!  We also accept [any] written material as wiki entries that fits in the lore, and you will get rewarded for it in the form of [Steam/Amazon Gift Cards] or [USD over Paypal].  If this lore interests you, please consider [joining our Discord] to get in contact with us; we would be happy to have you.\n\n    [Click this text to go back to the page you were on previously]");
					$("#webOutput").children(".hljs-selector-attr").each(function(i){ 
						var holdStr = $(this).html();
						var holdPart = holdStr.split(" ")[0];
						if(holdPart.startsWith("[C")){
							$(this).on("click",function(){
								runCommand("");
							});
						}
						if(holdPart.startsWith("[j")){
							$(this).on("click",function(){
								var win = window.open('https://discord.gg/QUdqDK6', '_blank');
								if (win) {
									win.focus();
								} else {
									alert('Please allow popups for this website');
								}
							});
						}
					});
				});
				
				$("#linkButton").on("click",function(){
					copy(linkDomain+"?link="+encodeURIComponent("cd "+thisUser.sitestr+":"+thisUser.pagestr));
					reply("Link has been copied to your machine's clipboard and is ready to be pasted elsewhere.");
					
				});
				
				function reply(text){
					$("#webOutput").html($("#webOutput").html()+text.replace("```css","").replace("```","")+"\n\n");
					hljs.initHighlighting.called = false;
					hljs.initHighlighting();
					$("#webOutput").children(".hljs-selector-attr").each(function(i){ 
						var holdStr = $(this).html();
						var holdPart = holdStr.split(" ")[0];
						if(holdPart.startsWith("[!")||holdPart.startsWith("[#")){
							$(this).on("click",function(){
								runCommand(holdPart.substr(1));
							});
						}
					});
					var ta = document.getElementById('webOutput');
					ta.scrollTop = ta.scrollHeight;
					refreshExtraButtons();
				};
				
				function reply2(text){
					$("#webOutput").html("");
					reply(text+"\n");
				};
				
				function refreshExtraButtons(){
					console.log(currentExtension);
					if(currentExtension == "TEXT" || currentExtension == "DICT"){
						$("#TEXTButtons").show();
						//$("#TEXTButtons").css("visibilty","visible");
					}else{
						$("#TEXTButtons").hide();
						//$("#TEXTButtons").css("visibilty","hidden");
					}
				};
				
				Number.prototype.mod = function(n) {
					return ((this%n)+n)%n;
				}; //thank you, https://web.archive.org/web/20090717035140if_/javascript.about.com/od/problemsolving/a/modulobug.htm

				String.prototype.replaceAll = function(a,b){
					return this.split(a).join(b);
				}
				
				var getNumOrdinalSuffix = function(num){
					if((num+"").endsWith("11")||(num+"").endsWith("12")||(num+"").endsWith("13")){
						return num+"th";
					}
					switch(num%10){
						case 1:
							return num+"st";
						case 2:
							return num+"nd";
						case 3:
							return num+"rd";
						default:
							return num+"th";
					}
				}

				var logOut = function(text){
					console.log(text);
				};
				var parseURL = function(inString){
					if(typeof inString !== 'string' || inString == ""){
						logOut("Invalid input for parseURL(): \'"+inString+"\'");
						return [];
					}
					var holdElements;
					var inString2;
					var ret = ["","",""]; //site, path, vars
					holdElements = inString.split(":");
					if(inString.indexOf("/")!=0){ //check if string contains site, or is in-site file path
						ret[0] = holdElements[0].toUpperCase();
						if(holdElements.length==1) return ret; //URL is only site string
						if(holdElements.length>2){
							logOut("Invalid input for parseURL(): \'"+inString+"\'");
							return [];
						}
					}
					inString2 = holdElements.pop(); //get rest of string after site is processed
					if(inString2.indexOf("/")!=0){ //string should start with "/" at this point for file path
						logOut("Invalid input for parseURL(): \'"+inString+"\'");
						return [];
					}
					holdElements = inString2.split("?");
					ret[1] = holdElements[0].toUpperCase();
					if(holdElements.length==1) return ret; //remaining URL is only path, no vars
					if(holdElements.length>2){
						logOut("Invalid input for parseURL(): \'"+inString+"\'");
						return [];
					}
					ret[2] = holdElements[1];
					return ret;
				}

				var abs = function(num){
					if(num<0){
						num*=1
					}
					return num;
				}
				var dateArrayToDayNum = (dateArray) => (dateArray[0]-1)+(dateArray[1]-1)*40+dateArray[2]*560;
				var periodArrayToDayNum = (dateArray) => dateArray[0]+dateArray[1]*40+dateArray[2]*560;
				var dayNumToDateArray = function(dayNum){
					var ret = [1,1,0];
					while(dayNum>=560){
						ret[2]++;
						dayNum-=560;
					}
					while(dayNum>=40){
						ret[1]++;
						dayNum-=40;
					}
					ret[0]+=dayNum;
					return ret;
				}
				var isMod = function(id){
					return true;
				}
				var isEditor = function(id,site){
					return true;
				}
				
				var splitDataIntoPages = (data) => String(data).split(String.fromCharCode(0));

				var newPage = function(path,auth){
					this.name="Untitled";
					this.path=path;
					this.isUp=true;
					this.data="[Unwritten]";
					this.links=[];
					this.meta = {author:auth,editor:auth,madeTime:date.format(new Date(), 'YYYY/MM/DD HH:mm:ss'),editTime:date.format(new Date(), 'YYYY/MM/DD HH:mm:ss')};
					this.extension = "";
				}
				var newDomain = function(path,owner){
					this.path=path;
					this.isUp=true;
					this.address="00.00";
					this.defPage="/MAIN";
					this.er2Page="/ER2";
					this.owners=[];
					this.owners[0]=getUserByID(owner).ID;
					this.pages=[];
					this.pages[0]=new newPage("/MAIN","<@"+users[getUserByInfo(owner)].ID+">");
					this.pages[0].data="css\nThis is the landing page of your new website!";
					this.pages[1]=new newPage("/ER2","<@"+users[getUserByInfo(owner)].ID+">");
					this.pages[1].data="css\nError 2! The page you requested does not exist.";
				}
				function newWord(name,meaning){//for dictionary file type
					if(typeof name !== 'string') name = "word name";
					if(typeof meaning !== 'string'|| meaning == '') meaning = "word meaning"; //shouldn't be meaningless
					this.name = name;
					this.pronunciation = name;
					this.definition = meaning;
					this.breakdown = "";
					this.roots = [];
					this.example = "example of word";
					this.origin = "ancient";
					this.allowReshuffle = true;
				}
				function newRoot(name,pronunciation,meaning){
					if(typeof name !== 'string') name = "root name";
					if(typeof pronunciation !== 'string' || pronunciation == '') pronunciation = "ruut-naym";
					if(typeof meaning !== 'string'|| meaning == '') meaning = "root meaning"; //shouldn't be meaningless
					this.name = name;
					this.type = "";
					this.pronunciation = pronunciation;
					this.meaning = meaning;
					this.examples = [];
					this.origin = "ancient";
					this.allowReshuffle = true;
				}
				function getArrayIndexByObjectName(ary,name){
					if(typeof ary !== 'object') return -1; //should be passed an array of objects with names
					if(typeof ary[0] !== 'object') return -1;
					if(typeof ary[0].name !== 'string') return -1;
					name = (''+name).toLowerCase(); //name should be a lowercase string
					for(var i = 0; i<ary.length; i++){
						if(ary[i].name.toLowerCase() == name) return i; //match by name
					}
					return -1;
				}
				function sortArrayByObjectName(ary,method){ //method being "alphabetical", etc.  Returns false if encountered error
					if(typeof ary !== 'object') return false; //should be passed an array of objects with names
					if(typeof ary[0] !== 'object') return false;
					if(typeof ary[0].name !== 'string') return false;
					method = (''+method).toLowerCase(); //needs to be lowercase string
					tempNameArray = [];
					for(var i = 0; i<ary.length; i++) tempNameArray.push(ary[i].name); //aggregate the object names
					switch(method){
						case "a":
						case "alphabetical":
						case "alpha":
						default:
							tempNameArray.sort();
						break;
					}
					while(tempNameArray.length) ary.unshift(ary.splice(getArrayIndexByObjectName(ary,tempNameArray.pop()),1)[0]); //actually sort it
				}

				var getSite = function(siteStr){
					siteStr=(siteStr+"").toUpperCase();
					var ret = -1;
					for(var i = 0; i<web.length; i++){
						if(web[i].path==siteStr||web[i].path==siteStr){
							ret=i;
						}
					}
					return ret;
				}

				var getUserByID = function(id){
					return -1;	
				}

				var getChannelByID = function(id){
					return -1;	
				}

				var getUserByName = function(name){
					return -1;	
				}
				var getUserByInfo = function(info){
					return -1;	
				}
				var condense = function(array, start, char){
					if(char===undefined){
						char = " ";
					}
					var say = ""
					for(var i = start;i<array.length;i++){
						say=say+array[i];
						if(i!==array.length-1){
							say = say+char;
						}
					}
					return say;
				}
				
				function getNumWikiEntries(){
					var say = 0, hold, holdsite = getSite("EQ.NETPEDIA");
					for(var q = 0; q<web[holdsite].pages.length; q++){
						hold = web[holdsite].pages[q].data.indexOf("[!1]");
						if(hold>16||hold==-1&&web[holdsite].pages[q].data.length>16){
							say++;
						}
					}
					return say;
				}
				
				function runCommand(comm){
					if(typeof comm !== 'string') comm=comm+"";
					var args = comm.split(" "); 
					if(args[0]==undefined){
						args[0]="";
					}
					var holdaddr = thisUser.sitestr+":"+thisUser.pagestr;
					if(thisUser.addressStack[thisUser.addressStack.length-1]!==holdaddr) thisUser.addressStack.push(holdaddr);
					while(thisUser.addressStack.length>32) thisUser.addressStack.shift();
					if(args[0].indexOf('!')==0){
						if(thisUser.site!=-1&&thisUser.page!=-1){
							holdstr=args[0].substring(1);
							holdint=parseInt(holdstr);
							args[0]="NULL";
							if(holdint>0){
								if(holdint<=web[thisUser.site].pages[thisUser.page].links.length){
									var holdstr = web[thisUser.site].pages[thisUser.page].links[holdint-1];
									var holdary = holdstr.split(":");
									if(holdary.length==2){
										thisUser.sitestr=holdary[0];
										thisUser.pagestr=holdary[1];
									}else{
										if(holdstr.indexOf("/")==0){
											thisUser.pagestr=holdstr;
										}else{
											thisUser.pagestr="";
											thisUser.sitestr=holdstr;
										}
									}
									args[0]="";
								}else{
									reply("```css\n!Error #5: Invalid parameter.\n$This page doesn't have that many links.```");
								}
							}else{
								reply("```css\n!Error #5: Invalid parameter.\n$No link number entered.```");
							}
						}else{
							reply("```css\n!Error #4: Not applicable.\n$Command \"!\" cannot be used here as this page has no links.```");
						}
						
					}
					var loopover = false;
					do {
						if(loopover)console.log("loop'a'doop");
						loopover = false;
						switch(args[0].toLowerCase()){
							case 'meta':
							case 'metadata':
								thisUser.site = -1;
								thisUser.sitestr=thisUser.sitestr.toUpperCase();
								thisUser.page = -1;
								thisUser.pagestr=thisUser.pagestr.toUpperCase();
								for(var i=0;i<web.length;i++){
									if(thisUser.sitestr==web[i].path){
										thisUser.site=i;
										break;
									}
								}
								if(thisUser.site!=-1){
									if(thisUser.pagestr==""||thisUser.pagestr=="/"){
										thisUser.pagestr=web[thisUser.site].defPage;
									}
									for(var i=0;i<web[thisUser.site].pages.length;i++){
										if(thisUser.pagestr==web[thisUser.site].pages[i].path){
											thisUser.page=i;
											break;
										}
									}
									if(thisUser.page==-1){
										if(web[thisUser.site].er2Page!=""){
											thisUser.pagestr=web[thisUser.site].er2Page;
											for(var i=0;i<web[thisUser.site].pages.length;i++){
												if(web[thisUser.site].er2Page==web[thisUser.site].pages[i].path){
													thisUser.page=i;
													break;
												}
											}
										}
									}
									if(args[1]==undefined){
										args[1]="";
									}
									if(args[1]==""){
										reply("`Metadata for "+thisUser.sitestr+":"+thisUser.pagestr+" -- "+web[thisUser.site].pages[thisUser.page].name+"`\nAuthor : "+web[thisUser.site].pages[thisUser.page].meta.author+"\nDate     : "+web[thisUser.site].pages[thisUser.page].meta.madeTime+"\nEditor   : "+web[thisUser.site].pages[thisUser.page].meta.editor+"\nDate     : "+web[thisUser.site].pages[thisUser.page].meta.editTime);
									}else{
										if(isMod(thisUser.ID)){
											switch(args[1].toLowerCase()){
												case 'auth':
												case 'author':
													web[thisUser.site].pages[thisUser.page].meta.author = args[2];
												break;
											}
										}else{
											reply("```css\n'Fraid you can't do that... >->```");
										}
									}
									if(thisUser.page!=-1){
										
									}else{
										reply("```css\n!Error #5: No data.\n$Request for this page did not return any data```");
									}
								}else{
									reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+"```");
									reply("```css\n!Error #9: No connection.\n$Could not establish connection with specified server.```");
								}
							break;
							case 'push':
							case 'pushstate':
								if(typeof thisUser.siteStack !== 'object'){
									thisUser.siteStack=[];
								}
								thisUser.siteStack.push(thisUser.sitestr);
								thisUser.siteStack.push(thisUser.pagestr);
								reply('```css\n!state pushed```');
							break;
							case 'pop':
							case 'popstate':
								if(typeof thisUser.siteStack !== 'object'){
									thisUser.siteStack=[];
								}
								if(thisUser.siteStack.length==0){
									reply('```css\n!state stack is empty```');
									break;
								}
								thisUser.pagestr = thisUser.siteStack.pop();
								thisUser.sitestr = thisUser.siteStack.pop();
								reply('```css\n!state popped```');
								loopover = true;
								args[0] = 'view';
							break;
							case 'movtree':
							case 'movetree':
							case 'mt':
							case 'reltree':
							case 'relocatetree':
							case 'rt':
								if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
									if(args[1]==""||args[1]==undefined){
										reply("```css\n!Error #6: First parameter string is empty or invalid```");
									}
									if(args[2]==""||args[2]==undefined){
										reply("```css\n!Error #6: Second parameter string is empty or invalid```");
									}
									args[1]=args[1].replace("\\",thisUser.pagestr+"/");
									args[2]=args[2].replace("\\",thisUser.pagestr+"/"); //formatting fun
									var str1 = args[1].toUpperCase();
									var str2 = args[2].toUpperCase();
									var say = 0;
									for(var i = 0; i<web.length; i++){
										for(var q = 0; q<web[i].pages.length; q++){
											say = say + web[i].pages[q].data.split(str1).length - 1; //get occurences of str 1 in page data
											web[i].pages[q].data = web[i].pages[q].data.replace(str1,str2); //replace
											say = say + web[i].pages[q].path.split(str1).length - 1; //get occurences of str 1 in paths
											web[i].pages[q].path = web[i].pages[q].path.replace(str1,str2); //replace
											for(var k = 0; k<web[i].pages[q].links.length; k++){
												say = say + web[i].pages[q].links[k].split(str1).length - 1; //get occurences of str 1 in links
												web[i].pages[q].links[k] = web[i].pages[q].links[k].replace(str1,str2); //replace
											}
										}
									}
									reply("```css\nReplaced "+say+" occurances of \""+str1+"\" with \""+str2+"\" in paths, pages, and links.```");
								}else{
									reply("```css\n!Error #4: Unknown command```");
								}
							
							break;
							case 'edit':
							case 'e':
								if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
									thisUser.site = -1;
									thisUser.sitestr=thisUser.sitestr.toUpperCase();
									thisUser.page = -1;
									thisUser.pagestr=thisUser.pagestr.toUpperCase();
									for(var i=0;i<web.length;i++){
										if(thisUser.sitestr==web[i].path){
											thisUser.site=i;
											break;
										}
									}
									if(thisUser.site!=-1){
										if(thisUser.pagestr==""||thisUser.pagestr=="/"){
											thisUser.pagestr=web[thisUser.site].defPage;
										}
										for(var i=0;i<web[thisUser.site].pages.length;i++){
											if(thisUser.pagestr==web[thisUser.site].pages[i].path){
												thisUser.page=i;
												break;
											}
										}
										if(thisUser.page==-1){
											if(web[thisUser.site].er2Page!=""){
												thisUser.pagestr=web[thisUser.site].er2Page;
												for(var i=0;i<web[thisUser.site].pages.length;i++){
													if(web[thisUser.site].er2Page==web[thisUser.site].pages[i].path){
														thisUser.page=i;
														break;
													}
												}
											}
										}
										if(thisUser.page==-1){
											reply("```css\n!Error #6: Not applicable.\n$This page file does not exist```");
										}else{
											if(args[1]==undefined){
												args[1]="";
											}
											var edited = true;
											switch(args[1].toLowerCase()){
												case "data":
												case "d":
													web[thisUser.site].pages[thisUser.page].data = condense(args,2).replace(/\\0/gi,String.fromCharCode(0));
													saveData();
												break;
												case "ext":
												case "extension":
												case "e":
													web[thisUser.site].pages[thisUser.page].extension = condense(args,2).toUpperCase().removeNonalphanumerics('');
												break;
												case "t":
												case "title":
													web[thisUser.site].pages[thisUser.page].name = condense(args,2);
												break;
												case "p":
												case "path":
													if(args[2]==undefined){
														args[2]="";
													}
													if(args[2]!="" && args[2]!="/"){
														if(args[2].indexOf(":")==-1&&args[2].indexOf(";")==-1&&args[2].indexOf(",")==-1&&args[2].indexOf("'")==-1&&args[2].indexOf("\"")==-1&&args[2].indexOf("!")==-1&&args[2].indexOf("$")==-1&&args[2].indexOf("+")==-1&&args[2].indexOf("=")==-1&&args[2].indexOf("|")==-1&&args[2].indexOf("\\")==-1&&args[2].indexOf("<")==-1&&args[2].indexOf(">")==-1){
															web[thisUser.site].pages[thisUser.page].path = args[2].toUpperCase();
															thisUser.pagestr=args[2].toUpperCase();
															reply("```css\n!Path changed```");
														}else{
															reply("```css\n!Error #5: Invalid parameter.\n$File paths cannot include the characters :;,'\"!$+=<>| or \\```");
														}
													}else{
														reply("```css\n!Error #5: Invalid parameter.\n$Invalid path assignment.```");
													}
													edited = false;
													loopover = true;
													args = ['view'];
												break;
												case "viewlinks":
												case "view":
												case "vl":
													var say = ""
													if(web[thisUser.site].pages[thisUser.page].links.length>0){
														for(i = 0; i < web[thisUser.site].pages[thisUser.page].links.length; i++){
															say = say + web[thisUser.site].pages[thisUser.page].links[i] + " ";
														}
													}else{
														say = "This page has no links."
													}
													reply("```"+say+"```");
													edited = false;
												break;
												case "setlinks":
												case "set":
												case "sl":
													web[thisUser.site].pages[thisUser.page].links = [];
													for(i = 2; i < args.length; i++){
														if(args[i]==undefined){
															args[i]=""
														}
														args[i]=args[i].replace("\\",thisUser.pagestr+"/")
														web[thisUser.site].pages[thisUser.page].links[i-2] = args[i].toUpperCase();
													}
													edited = false;
													loopover = true;
													args = ['e','vl'];
												break;
												case "n":
												case "newPage":
												case "new":
													if(args[2]!=undefined && args[2]!="" && args[2]!="/"){
														args[2]=args[2].replace("\\",thisUser.pagestr+"/")
														if(args[2].indexOf(":")==-1&&args[2].indexOf(";")==-1&&args[2].indexOf(",")==-1&&args[2].indexOf("'")==-1&&args[2].indexOf("\"")==-1&&args[2].indexOf("!")==-1&&args[2].indexOf("$")==-1&&args[2].indexOf("+")==-1&&args[2].indexOf("=")==-1&&args[2].indexOf("|")==-1&&args[2].indexOf("<")==-1&&args[2].indexOf(">")==-1){
															web[thisUser.site].pages[web[thisUser.site].pages.length] = new newPage(args[2].toUpperCase(),"<@"+message.author.id+">");
															thisUser.pagestr=args[2].toUpperCase();
															reply("```css\n!Page created```");
														}else{
															reply("```css\n!Error #5: Invalid parameter.\n$File paths cannot include the characters :;,'\"!$+=<> or |```");
														}
													}else{
														reply("```css\n!Error #5: Invalid parameter.\n$Invalid path assignment.```");
													}
													edited = false;
												break;
												case "delete":
													web[thisUser.site].pages.splice(thisUser.page,1);
													thisUser.page=-1;
													thisUser.pagestr=web[thisUser.site].defPage;
													reply("```css\n!Page deleted```");
													edited = false;
												break;
												default:
													reply("```css\n!Error 4: Unknown command```");
													edited = false;
												break;
											}
											if(edited){
												web[thisUser.site].pages[thisUser.page].meta.editor="<@"+message.author.id+">";
												web[thisUser.site].pages[thisUser.page].meta.editTime=date.format(new Date(), 'YYYY/MM/DD HH:mm:ss');
												loopover = true;
												args[0] = 'view';
											}
										}
									}else{
										reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+"```");
										reply("```css\n!Error #8: No connection.\n$Could not establish connection with specified server.```");
									}
								}else{
									reply("```css\n!Error #7: Insufficient privileges.```");
								}
							break;
							case 'goto':
							case 'cd':
								if(args[1]==undefined){
									break;
								}
								if(args[1]!=".."){
									var holdary = args[1].split(":");
									if(holdary.length==2){
										thisUser.sitestr=holdary[0];
										thisUser.pagestr=holdary[1];
									}else{
										if(args[1].indexOf("/")==0){
											thisUser.pagestr=args[1];
										}else{
											thisUser.pagestr="";
											thisUser.sitestr=args[1];
										}
									}
								}else{
									var holdstr = thisUser.pagestr;
									var holdary = thisUser.pagestr.split('/');
									holdstr="";
									for(i=1;i<holdary.length-1;i++){
										holdstr=holdstr+"/"+holdary[i];
									}
									thisUser.pagestr=holdstr;
								}
							case 'back':
								if(args[0].toLowerCase()=='back'){
									thisUser.addressStack.pop();
									if(typeof thisUser.addressStack[thisUser.addressStack.length-1] == 'string'){
										var holdstrs = thisUser.addressStack[thisUser.addressStack.length-1].split(':');
										thisUser.sitestr=holdstrs[0];
										thisUser.pagestr=holdstrs[1];
									}else{
										reply("```css\n!Error #5: Address stack is empty.\n$Can not go back any further```");
									}
								}
							case '':
							case 'view':
								thisUser.site = -1;
								thisUser.sitestr=thisUser.sitestr.toUpperCase();
								thisUser.page = -1;
								thisUser.pagestr=thisUser.pagestr.toUpperCase();
								for(var i=0;i<web.length;i++){
									if(thisUser.sitestr==web[i].path){
										thisUser.site=i;
										break;
									}
								}
								if(thisUser.site!=-1){
									if(thisUser.pagestr==""||thisUser.pagestr=="/"){
										thisUser.pagestr=web[thisUser.site].defPage;
									}
									for(var i=0;i<web[thisUser.site].pages.length;i++){
										if(thisUser.pagestr==web[thisUser.site].pages[i].path){
											thisUser.page=i;
											break;
										}
									}
									if(thisUser.page==-1){
										if(web[thisUser.site].er2Page!=""){
											thisUser.pagestr=web[thisUser.site].er2Page;
											for(var i=0;i<web[thisUser.site].pages.length;i++){
												if(web[thisUser.site].er2Page==web[thisUser.site].pages[i].path){
													thisUser.page=i;
													break;
												}
											}
										}
									}
									say = "";
									if(web[thisUser.site].pages[thisUser.page].extension!==""){
										say = ".";
									}
									
									if(thisUser.page!=-1){
										thisUser.webvars.state = web[thisUser.site].pages[thisUser.page].extension;
										currentExtension = thisUser.webvars.state;
										switch(web[thisUser.site].pages[thisUser.page].extension.toLowerCase()){
											case "srch":
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+"```");
												var holddat = web[thisUser.site].pages[thisUser.page].data.split("\n");
												thisUser.webvars.search = {site:holddat[0],pagePath:holddat[1],resultPage:1,searchTerm:""};
												reply("```"+condense(holddat,3,"\n")+"```");
											break;
											case "text":
												thisUser.webvars.text = {page:0};
												args[0]="render";
												loopover=true;
											break;
											case "doub":
												args[0]="render";
												loopover=true;
											break;
											case "cldr":
											case "clnd":
												thisUser.webvars.calendar = {};
												try{
													thisUser.webvars.calendar.calData=JSON.parse(web[thisUser.site].pages[thisUser.page].data);
												}catch(err){
													thisUser.webvars.calendar.calData = undefined;
													console.log(err);
												}
												if(thisUser.webvars.calendar.calData==undefined){
													thisUser.webvars.calendar.month=1;
													thisUser.webvars.calendar.year=1;
												}else{
													thisUser.webvars.calendar.month=thisUser.webvars.calendar.calData.startMonth;
													thisUser.webvars.calendar.year=thisUser.webvars.calendar.calData.startYear;
												}
												thisUser.webvars.calendar.day=-1;
												thisUser.webvars.calendar.eventsPage=1;
												args[0]="render";
												loopover=true;
											break;
											case "dict":
												thisUser.webvars.dictionary = {};
												try{
													thisUser.webvars.dictionary.dicData=JSON.parse(web[thisUser.site].pages[thisUser.page].data);
												}catch(err){
													thisUser.webvars.dictionary.dicData = undefined;
													console.log(err);
												}
												if(thisUser.webvars.dictionary.dicData == undefined){
													thisUser.webvars.dictionary.sortBy = "alphabetical";
												}else{
													thisUser.webvars.dictionary.sortBy = thisUser.webvars.dictionary.dicData.defSortBy; //get default sort
												}
												thisUser.webvars.dictionary.screen="main"; //main, roots, words
												thisUser.webvars.dictionary.page=0;
												thisUser.webvars.dictionary.selected=""; //if this is empty string, then is in search mode if on roots or words screen
												args[0]="render";
												loopover=true;
											break;
											default: //no file extension
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+"```");
												reply("```"+web[thisUser.site].pages[thisUser.page].data+"```");
										}
									}else{
										reply("```css\n!Error #2: No data.\n$Request for this page did not return any data```");
									}
								}else{
									reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+"```");
									reply("```css\n!Error #8: No connection.\n$Could not establish connection with specified server.```");
								}
							break;
							default:
								if(thisUser.webvars.state!==""){
									if(typeof thisUser.webvars.state !== "string") thisUser.webvars.state = thisUser.webvars.state + "";
									switch(thisUser.webvars.state.toUpperCase()){
										case "TEXT":
											var doRefresh = false;
											switch(args[0].toLowerCase()){
												case "ep":
												case "editpage":
												case "epage":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														var holdpagedata = splitDataIntoPages(web[thisUser.site].pages[thisUser.page].data);
														if(thisUser.webvars.text.page<0) thisUser.webvars.text.page=0;
														if(thisUser.webvars.text.page>=holdpagedata.length) thisUser.webvars.text.page=holdpagedata.length-1;
														doRefresh = true;
														var edited = false;
														switch(args[1].toLowerCase()){
															case 'd':
															case 'data':
																holdpagedata.splice(thisUser.webvars.text.page,1,condense(args,2));
																web[thisUser.site].pages[thisUser.page].data=condense(holdpagedata,0,String.fromCharCode(0));
																edited=true;
															break;
															case 'delete':
															case 'del':
																holdpagedata.splice(thisUser.webvars.text.page,1);
																web[thisUser.site].pages[thisUser.page].data=condense(holdpagedata,0,String.fromCharCode(0));
																edited=true;
															break;
															case 'n':
															case 'new':
															case 'newpage':
																thisUser.webvars.text.page++;
																holdpagedata.splice(thisUser.webvars.text.page,0,"void");
																web[thisUser.site].pages[thisUser.page].data=condense(holdpagedata,0,String.fromCharCode(0));
																edited=true;
															break;
															default:
																reply("```css\n!Error 4: Unknown command```");
														}
														if(edited){
															web[thisUser.site].pages[thisUser.page].meta.editor="<@"+message.author.id+">";
															web[thisUser.site].pages[thisUser.page].meta.editTime=date.format(new Date(), 'YYYY/MM/DD HH:mm:ss');
														}
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "next":
												case "nextpage":
													thisUser.webvars.text.page++;
													doRefresh = true;
												break;
												case "last":
												case "lastpage":
												case "previous":
												case "prev":
													thisUser.webvars.text.page--;
													doRefresh = true;
												break;
												case "page":
													var holdNum = parseInt(args[1]);
													if(holdNum<0||holdNum>-1){
														holdNum--;
														thisUser.webvars.text.page = holdNum;
														doRefresh = true;
														break;
													}else{
														reply("```css\nError #6\n$Input was not an integer```");
														break;
													}
												break;
												case 'render':
													doRefresh = true;
												break;
											}
											if(doRefresh){
												var holdpagedata = splitDataIntoPages(web[thisUser.site].pages[thisUser.page].data);
												say = "";
												if(web[thisUser.site].pages[thisUser.page].extension!==""){
													say = ".";
												}
												if(thisUser.webvars.text.page<0) thisUser.webvars.text.page=0;
												if(thisUser.webvars.text.page>=holdpagedata.length) thisUser.webvars.text.page=holdpagedata.length-1;
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+"\n[page "+(thisUser.webvars.text.page+1)+"/"+holdpagedata.length+"]\nCommands: \"next\",\"prev\"```");
												reply("```"+holdpagedata[thisUser.webvars.text.page]+"```");
											}
										break;
										case "DOUB":
											var doRefresh = false;
											switch(args[0].toLowerCase()){
												case 'render':
													doRefresh = true;
												break;
											}
											if(doRefresh){
												var holdpagedata = splitDataIntoPages(web[thisUser.site].pages[thisUser.page].data);
												say = "";
												if(web[thisUser.site].pages[thisUser.page].extension!==""){
													say = ".";
												}
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+"```");
												reply("```"+holdpagedata[0]+"```");
												if(holdpagedata.length>1) reply("```"+holdpagedata[1]+"```");
											}
										break;
										case "SRCH":
											var doRefresh = false;
											var doLink = false;
											var holdLink = 1;
											switch(args[0].toLowerCase()){
												case "search":
													thisUser.webvars.search.searchTerm = condense(args,1);
													reply("```css\nSearching term \""+thisUser.webvars.search.searchTerm+"\" in "+thisUser.webvars.search.pagePath+" of "+thisUser.webvars.search.site+"```")
													doRefresh = true;
												break;
												case "next":
												case "nextpage":
													thisUser.webvars.search.resultPage++;
													doRefresh = true;
												break;
												case "last":
												case "lastpage":
												case "previous":
												case "prev":
													thisUser.webvars.search.resultPage--;
													doRefresh = true;
												break;
												case "page":
													var holdNum = parseInt(args[1]);
													if(holdNum<0||holdNum>-1){
														thisUser.webvars.search.resultPage = holdNum;
														doRefresh = true;
														break;
													}else{
														reply("```css\nError #6\n$Input was not an integer```");
														break;
													}
												break;
												default:
													if(args[0].indexOf('#')==0){
														doLink = true;
														holdLink = args[0].substring(1);
														break;														
													}else{
														reply("```css\n!Error #4: Unknown command.```");
													}
												
											}
											var holdSite = getSite(thisUser.webvars.search.site);
											if(holdSite==-1){
												reply("css\n!Error #9\n$No connection with domain "+thisUser.webvars.search.site+"```");
											}
											var holdResults = [];
											var sayResults = [];
											var say = 0;
											for(var i = 0; i<web[holdSite].pages.length; i++){
												var holdOccurances = web[holdSite].pages[i].data.toLowerCase().split(thisUser.webvars.search.searchTerm.toLowerCase()).length-1;
												if(holdOccurances>0){
													holdResults.push([holdOccurances,web[holdSite].pages[i].name,web[holdSite].pages[i].path,thisUser.webvars.search.site]);
												}
											}
											var topVal = 0;
											var topPos = 0;
											while(holdResults.length>0){
												topVal = 0;
												for(var i = 0; i<holdResults.length; i++){
													if(holdResults[i][0]>topVal){
														topVal=holdResults[i][0];
														topPos=i;
													}
												}
												sayResults.push(holdResults.splice(topPos,1)[0]);
											}
											var numPages = Math.round(sayResults.length/9+0.5);
											if(thisUser.webvars.search.resultPage<1){
												thisUser.webvars.search.resultPage=1;
											}
											if(thisUser.webvars.search.resultPage>numPages){
												thisUser.webvars.search.resultPage=numPages;
											}
										
											if(doRefresh){
												var say = "Results for \""+thisUser.webvars.search.searchTerm+"\":";
												if(sayResults.length!==0){
													var linkNum=1;
													for(var i = (thisUser.webvars.search.resultPage-1)*9; i<thisUser.webvars.search.resultPage*9; i++){
														if(i>=sayResults.length) break;
														say = say + "\n[#"+linkNum+"] "+sayResults[i][0]+" Hits - "+sayResults[i][1]+"\n"+sayResults[i][2];
														linkNum++;
													}
													say = say + "\n[Page ["+thisUser.webvars.search.resultPage+"/"+numPages+"]";
													reply("```css\n"+say+'\n\nCommands:\n"search [phrase]" - Search a new phrase\n"next"            - Next result page\n"prev"            - Previous result page\n"page [number]"   - View a result page\n"#[number]"       - Go to one of the displayed result pages (Ex. "#3" to go to the third result)```');
												}else{
													reply("```css\nNo results for \""+thisUser.webvars.search.searchTerm+"\""+'\nCommands:\n"search [phrase]" - Search a new phrase\n"next"            - Next result page\n"prev"            - Previous result page\n"page [number]"   - View a result page\n"#[number]"       - Go to one of the displayed result pages (Ex. "#3" to go to the third result)```');
												}
											}
											if(doLink){
												var holdval=parseInt(holdLink)+(thisUser.webvars.search.resultPage-1)*9;
												if(holdval+(thisUser.webvars.search.resultPage-1)*9>0&&holdval+(thisUser.webvars.search.resultPage-1)*9<=sayResults.length){
													thisUser.sitestr=sayResults[holdval+(thisUser.webvars.search.resultPage-1)*9-1][3];
													thisUser.pagestr=sayResults[holdval+(thisUser.webvars.search.resultPage-1)*9-1][2];
													console.log(thisUser.pagestr+" aaa");
													args[0]="";
													loopover = true;
												}else{
													reply("```css\nError #6\n$Improper result number```");
												}
											}
										break;
										case 'CLDR':
										case 'CLND':
											var doRefresh = false;
											var doLink = false;
											switch(args[0].toLowerCase()){
												case "save":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														web[thisUser.site].pages[thisUser.page].data = JSON.stringify(thisUser.webvars.calendar.calData);
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "next":
												case "nextpage":
													if(thisUser.webvars.calendar.day>0){
														thisUser.webvars.calendar.eventsPage++;
														doRefresh = true;
													}else{
														reply("```css\nError #6\n$No day selected```");
													}
												break;
												case "lastpage":
												case "previous":
												case "prev":
												case "last":
													if(thisUser.webvars.calendar.day>0){
														thisUser.webvars.calendar.eventsPage--;
														doRefresh = true;
													}else{
														reply("```css\nError #6\n$No day selected```");
													}
												break;
												case "nextmonth":
													if(thisUser.webvars.calendar.month++===14){
														thisUser.webvars.calendar.month=1;
														thisUser.webvars.calendar.year++;
													}
													thisUser.webvars.calendar.day=-1
													doRefresh = true;
												break;
												case "lastmonth":
												case "prevmonth":
												case "previousmonth":
													if(thisUser.webvars.calendar.month--===1){
														thisUser.webvars.calendar.month=14;
														thisUser.webvars.calendar.year--;
													}
													thisUser.webvars.calendar.day=-1
													doRefresh = true;
												case "render":
													doRefresh = true;
												break;
												case "day":
												case "select":
													var holdNum = parseInt(args[1]);
													if(holdNum<0||holdNum>-1){
														if(holdNum>0&&holdNum<=40){
															thisUser.webvars.calendar.day = holdNum;
															thisUser.webvars.calendar.eventsPage = 1;
															doRefresh = true;
															break;
														}else{
															reply("```css\nError #6\n$Input is not valid day of month (1 - 40)```");
															break;
														}
														doRefresh = true;
														break;
													}else{
														reply("```css\nError #6\n$Input was not an integer```");
														break;
													}
												break;
												case "month":
													var holdNum = parseInt(args[1]);
													if(holdNum<0||holdNum>-1){
														if(holdNum>0&&holdNum<=14){
															thisUser.webvars.calendar.month = holdNum;
															thisUser.webvars.calendar.eventsPage = 1;
															doRefresh = true;
															break;
														}else{
															reply("```css\nError #6\n$Input is not valid month of the year (1 - 14)```");
															break;
														}
														doRefresh = true;
														break;
													}else{
														reply("```css\nError #6\n$Input was not an integer```");
														break;
													}
												break;
												case "year":
													var holdNum = parseInt(args[1]);
													if(holdNum<0||holdNum>-1){
														thisUser.webvars.calendar.year = holdNum;
														thisUser.webvars.calendar.eventsPage = 1;
														doRefresh = true;
														break;
														doRefresh = true;
														break;
													}else{
														reply("```css\nError #6\n$Input was not an integer```");
														break;
													}
												break;
												case "addevent":
												case "newevent":
												case "new":
												case "add": //d m y repeatNum d m y link name
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(args.length<9){
															reply("```css\nError #6\n$Not enough arguments passed to event constructor (9 minimum)```");
															break;
														}
														var holdDay = parseInt(args[1]);
														if(!isNaN(holdDay)&&holdDay>0&&holdDay<=40){
															
														}else{
															reply("```css\nError #6\n$Input day (argument 1) is invalid```");
															break;
														}
														var holdMonth = parseInt(args[2]);
														if(!isNaN(holdMonth)&&holdMonth>0&&holdMonth<=14){
															
														}else{
															reply("```css\nError #6\n$Input month (argument 2) is invalid```");
															break;
														}
														var holdYear = parseInt(args[3]);
														if(!isNaN(holdYear)){
															
														}else{
															reply("```css\nError #6\n$Input year (argument 3) is invalid```");
															break;
														}
														var holdRepeat = parseInt(args[4]);
														if(!isNaN(holdRepeat)&&holdRepeat>=-1){
															
														}else{
															reply("```css\nError #6\n$Input repeat (argument 4) is invalid```");
															break;
														}
														
														var holdPeriodDay = parseInt(args[5]);
														if(!isNaN(holdPeriodDay)&&holdPeriodDay>=0&&holdPeriodDay<=40){
															
														}else{
															reply("```css\nError #6\n$Input period day (argument 5) is invalid```");
															break;
														}
														var holdPeriodMonth = parseInt(args[6]);
														if(!isNaN(holdPeriodMonth)&&holdPeriodMonth>=0&&holdPeriodMonth<=14){
															
														}else{
															reply("```css\nError #6\n$Input period month (argument 6) is invalid```");
															break;
														}
														var holdPeriodYear = parseInt(args[7]);
														if(!isNaN(holdPeriodYear)&&holdPeriodYear>=0){
															
														}else{
															reply("```css\nError #6\n$Input period year (argument 7) is invalid```");
															break;
														}
														
														var holdLink;
														if(typeof args[8] !== 'string'){
															holdLink = "";
														}else{
															holdLink = args[8].toUpperCase();
														}
														
														var holdName = condense(args,9);
														
														thisUser.webvars.calendar.calData.events.push({name:holdName,origin:[holdDay,holdMonth,holdYear],period:[holdPeriodDay,holdPeriodMonth,holdPeriodYear],repeats:holdRepeat,link:holdLink,tags:["generic"]});
														
														doRefresh = true;
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
													
												break;
												default:
													if(thisUser.webvars.calendar.day>0){
														if(args[0].indexOf('#')==0){
															doLink = true;
															holdLink = args[0].substring(1);
															break;														
														}else{
															reply("```css\n!Error #4: Unknown command```");
														}
															
													}else{
														reply("```css\nError #6\n$No day selected```");
													}
											}
											if(thisUser.webvars.calendar.calData == undefined){
												reply("```css\n!Error #0: Invalid Operation\n$Data in .CLDR file is corrupted```");
												break;
											}
											var getEventsOfDay = function(date){
												if(typeof date !== 'number') date = dateArrayToDayNum(date);
												var ret = [];
												for(var i = 0; i<thisUser.webvars.calendar.calData.events.length; i++){
													var eventDate = dateArrayToDayNum(thisUser.webvars.calendar.calData.events[i].origin);
													if(eventDate == date){
														ret.push(i);
													}else if(date > eventDate && thisUser.webvars.calendar.calData.events[i].repeats !== 0){//check if is repeating event and if is after origin
														var relativeDate = date-eventDate;
														//console.log("b"+i+" "+relativeDate+"%"+periodArrayToDayNum(thisUser.webvars.calendar.calData.events[i].period)+"="+relativeDate%periodArrayToDayNum(thisUser.webvars.calendar.calData.events[i].period)+" /="+relativeDate/periodArrayToDayNum(thisUser.webvars.calendar.calData.events[i].period)+"<"+thisUser.webvars.calendar.calData.events[i].repeats);
														var holdNum = relativeDate%periodArrayToDayNum(thisUser.webvars.calendar.calData.events[i].period);
														if(holdNum==0&&(relativeDate/periodArrayToDayNum(thisUser.webvars.calendar.calData.events[i].period)<=thisUser.webvars.calendar.calData.events[i].repeats||thisUser.webvars.calendar.calData.events[i].repeats==-1)){ 
															//console.log("c"+i);
															ret.push(i)//if date lands on an interval for this event, and is less than or equal to repeatNum*period away from origin
														}
													}
												}
												//console.log(ret);
												return ret;
											}
											if(doRefresh){
												say = "";
												if(web[thisUser.site].pages[thisUser.page].extension!==""){
													say = ".";
												}
												var say2 = "";
												var say3 = "";
												if(thisUser.webvars.calendar.day>0&&thisUser.webvars.calendar.day<=40){
													say2 = getNumOrdinalSuffix(thisUser.webvars.calendar.day)+" of ";
													say3 = thisUser.webvars.calendar.day+"/";
												}
												if(thisUser.webvars.calendar.year<thisUser.webvars.calendar.calData.minYear) thisUser.webvars.calendar.year<thisUser.webvars.calendar.calData.minYear
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+'\nCommands:\n"next" - Next Month\n"prev" - Previous Month\n"day [number]" - Select a specific day (ex: "day 23")\n"month [number]" - Go to a specific month (ex: "month 2")\n"year [number]" - Go to a specific year (ex: "year 107")```');
												var say = "["+say2+months[thisUser.webvars.calendar.month-1]+", Year "+thisUser.webvars.calendar.year+" -- "+say3+thisUser.webvars.calendar.month+"/"+thisUser.webvars.calendar.year+"]\n┌────────────────────┐\n";
												for(var q = 0; q<8; q++){
													say = say +"│";
													for(var i = 0; i<5; i++){
														var dayNum = i+q*5+1;
														var holdEvents = getEventsOfDay([dayNum,thisUser.webvars.calendar.month,thisUser.webvars.calendar.year]);
														if(dayNum == thisUser.webvars.calendar.day){
																say = say+"["+dayNum.pad(2,'0')+"]";
														}else{
															if(holdEvents.length>0){
																say = say+"-"+dayNum.pad(2,'0')+"-";
															}else{
																say = say+" "+dayNum.pad(2,'0')+" ";
															}
														}
													}
													say = say +"│\n";
												}
												say = say + "└────────────────────┘";
												reply("```css\n"+say+"```");
												
												say = "";
												if(thisUser.webvars.calendar.day>0){
													var holdEvents = getEventsOfDay([thisUser.webvars.calendar.day,thisUser.webvars.calendar.month,thisUser.webvars.calendar.year]);
													var numPages = Math.round(holdEvents.length/9+0.5);
													if(thisUser.webvars.calendar.eventsPage<1) thisUser.webvars.calendar.eventsPage = 1;
													if(thisUser.webvars.calendar.eventsPage>numPages) thisUser.webvars.calendar.eventsPage = numPages;
													if(holdEvents.length){
														var say = "css\n"
														//console.log(holdEvents);
														var linkNum=1;
														for(var i = (thisUser.webvars.calendar.eventsPage-1)*9; i<thisUser.webvars.calendar.eventsPage*9; i++){
															if(i>=holdEvents.length) break;
															say = say + "\n[#"+linkNum+"] "+thisUser.webvars.calendar.calData.events[holdEvents[i]].name+"\n"+thisUser.webvars.calendar.calData.events[holdEvents[i]].link;
															linkNum++;
														}
														say = say + "\n[Page ["+thisUser.webvars.calendar.eventsPage+"/"+numPages+"]]";
													}else{
														say = "No events for this day.\nType \"Day [day number]\" to select a different day of the month.";
													}
												}else{
													say = "No day selected.\nType \"Day [day number]\" to select a day of the month.";
												}
												reply("```"+say+"```");
											}
											if(doLink){
												var holdEvents = getEventsOfDay([thisUser.webvars.calendar.day,thisUser.webvars.calendar.month,thisUser.webvars.calendar.year]);
												var holdval=parseInt(holdLink)+(thisUser.webvars.calendar.eventsPage-1)*9;
												if(holdval+(thisUser.webvars.calendar.eventsPage-1)*9>0&&holdval+(thisUser.webvars.calendar.eventsPage-1)*9<=holdEvents.length){
													var holdElements = parseURL(thisUser.webvars.calendar.calData.events[holdEvents[holdval+(thisUser.webvars.calendar.eventsPage-1)*9-1]].link);
													if(holdElements.length){
														if(holdElements[0]!==""){
															thisUser.sitestr = holdElements[0];
														}
														thisUser.pagestr = holdElements[1];
														args[0]="";
														loopover = true;
													}else{
														reply("```css\nThis event does not have a valid link associated with it.```");
													}
												}else{
													reply("```css\nError #6\n$Improper result number```");
												}
											}
										break;
										case 'DICT':
											if(thisUser.webvars.dictionary.dicData == undefined){
												reply("```css\n!Error #0: Invalid Operation\n$Data in .DICT file is corrupted```");
												break;
											}
											var doRefresh = false;
											var doLink = false;
											var numRootPages = Math.round(thisUser.webvars.dictionary.dicData.roots.length/16+0.5); //how many pages there should be in root browsing
											var numWordPages = Math.round(thisUser.webvars.dictionary.dicData.words.length/8+0.5); //how many pages there should be in word browsing
											
											switch(args[0].toLowerCase()){
												case "save":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														web[thisUser.site].pages[thisUser.page].data = JSON.stringify(thisUser.webvars.dictionary.dicData);
														reply("```css\nDictionary has been saved```");
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "main":
												case "m":
													thisUser.webvars.dictionary.selected = "";
													thisUser.webvars.dictionary.screen = "main";
													doRefresh = true;
												break;
												case 'n':
												case "next":
												case "nextpage":
													if(thisUser.webvars.dictionary.selected==""){ //nothing selected means on browsing
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																thisUser.webvars.dictionary.page = (thisUser.webvars.dictionary.page+1).mod(numRootPages); //mod by the number of pages there should be
															break;
															case "words":
																thisUser.webvars.dictionary.page = (thisUser.webvars.dictionary.page+1).mod(numWordPages); //mod by the number of pages there should be
															break;
															default:
														}
													}else{
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																thisUser.webvars.dictionary.selected = thisUser.webvars.dictionary.dicData.roots[(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,thisUser.webvars.dictionary.selected)+1).mod(thisUser.webvars.dictionary.dicData.roots.length)].name; //take the current word, get its root index, increment it, mod it by the number of roots, get the root at the new index, and get that root's name
															break;
															case "words":
																thisUser.webvars.dictionary.selected = thisUser.webvars.dictionary.dicData.words[(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,thisUser.webvars.dictionary.selected)+1).mod(thisUser.webvars.dictionary.dicData.words.length)].name; //take the current word, get its word index, increment it, mod it by the number of words, get the word at the new index, and get that word's name
															break;
															default:
														}
													}
													doRefresh = true;
												break;
												case 'p':
												case "lastpage":
												case "previous":
												case "prev":
												case "last":
													if(thisUser.webvars.dictionary.selected==""){ //nothing selected means on browsing
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																thisUser.webvars.dictionary.page = (thisUser.webvars.dictionary.page-1).mod(numRootPages); //mod by the number of pages there should be
															break;
															case "words":
																thisUser.webvars.dictionary.page = (thisUser.webvars.dictionary.page-1).mod(numWordPages); //mod by the number of pages there should be
															break;
															default:
														}
													}else{
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																thisUser.webvars.dictionary.selected = thisUser.webvars.dictionary.dicData.roots[(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,thisUser.webvars.dictionary.selected)-1).mod(thisUser.webvars.dictionary.dicData.roots.length)].name; //take the current word, get its root index, decrement it, mod it by the number of roots, get the root at the new index, and get that root's name
															break;
															case "words":
																thisUser.webvars.dictionary.selected = thisUser.webvars.dictionary.dicData.words[(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,thisUser.webvars.dictionary.selected)-1).mod(thisUser.webvars.dictionary.dicData.words.length)].name; //take the current word, get its word index, decrement it, mod it by the number of words, get the word at the new index, and get that word's name
															break;
															default:
														}
													}
													doRefresh = true;
												break;
												case "newroot":
												case "nr": //root, pronunciation, definition
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(args[1]==""||typeof args[1] != 'string'){
															reply("```css\n!Error #6: Root name cannot be empty.```"); 
															break;
														}
														if(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,args[1])!=-1){
															reply("```css\n!Error #0: This root already exists in the dictionary.```"); 
															break;
														}
														thisUser.webvars.dictionary.dicData.roots.push(new newRoot(args[1],args[2],condense(args,3)));
														thisUser.webvars.dictionary.screen = "roots";
														thisUser.webvars.dictionary.selected = args[1];
														doRefresh = true;
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "newword":
												case "nw":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(args[1]==""||typeof args[1] != 'string'){
															reply("```css\n!Error #6: Word name cannot be empty.```"); 
															break;
														}
														if(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,args[1])!=-1){
															reply("```css\n!Error #0: This word already exists in the dictionary.```"); 
															break;
														}
														thisUser.webvars.dictionary.dicData.words.push(new newWord(args[1],condense(args,2)));
														thisUser.webvars.dictionary.screen = "words";
														thisUser.webvars.dictionary.selected = args[1];
														doRefresh = true;
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "smartnewword":
												case "snw":
												case "sn":
												case "sw": //args = name, single-quote-separated roots, definition
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(args[1]==""||typeof args[1] != 'string'){
															reply("```css\n!Error #6: Word name cannot be empty.```"); 
															break;
														}
														if(getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,args[1])!=-1){
															reply("```css\n!Error #0: This word already exists in the dictionary.```"); 
															break;
														}
														if(typeof args[2] != "string") args[2] = "";
														var holdWord = new newWord(args[1],condense(args,3));
														holdWord.roots=args[2].toLowerCase().split("'"); //split up the roots
														thisUser.webvars.dictionary.dicData.words.push(holdWord); //actually add it
														thisUser.webvars.dictionary.screen = "words";
														thisUser.webvars.dictionary.selected = args[1];
														doRefresh = true;
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break; 
												case "compile":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														var dat = thisUser.webvars.dictionary.dicData;
														var holdWord, holdIndex, holdRoot;
														for(i=0; i<dat.roots.length; i++) dat.roots[i].examples = []; //clear all the examples to remake later
														for(i=0; i<dat.words.length; i++){
															holdWord = dat.words[i];
															holdWord.pronunciation = "";
															for(q=0; q<holdWord.roots.length; q++){
																if(q!=0) holdWord.pronunciation = holdWord.pronunciation+"-"; //dashes between syllables
																holdIndex = getArrayIndexByObjectName(dat.roots,holdWord.roots[q]);
																if(holdIndex == -1) continue; //if the root doesn't exist, don't even try
																holdRoot = dat.roots[holdIndex];
																holdWord.pronunciation = holdWord.pronunciation+holdRoot.pronunciation; //fill out the pronunciation
																holdRoot.examples.push(holdWord.name); //make a reference for this word in the root
															}
														}
														doRefresh = true;
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												break;
												case "delete":
												case "remove":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(thisUser.webvars.dictionary.selected=="" || thisUser.webvars.dictionary.screen == "main"){
															reply("```css\n!Error #0: Nothing selected to delete```");
															break;
														}
														if(typeof args[1] != 'string') args[1] = ""; //don't want anything to break now
														args[2] = condense(args,2);
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																var holdIndex = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,thisUser.webvars.dictionary.selected);
																if (holdIndex == -1){
																	reply("```css\n!Error #0: Nothing selected to delete; selected item doesn't exist.```");
																	break;
																}
																thisUser.webvars.dictionary.dicData.roots.splice(holdIndex,1); //delete the root
																thisUser.webvars.dictionary.selected="";
																doRefresh = true;
															break;
															case "words":
																var holdIndex = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,thisUser.webvars.dictionary.selected);
																if (holdIndex == -1){
																	reply("```css\n!Error #0: Nothing selected to edit; selected item doesn't exist.```");
																	break;
																}
																thisUser.webvars.dictionary.dicData.words.splice(holdIndex,1); //delete the word
																thisUser.webvars.dictionary.selected="";
																doRefresh = true;
															break;
														}
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "define":
												case "d":
												case "assert":
												case "a":
												case "change":
												case "c":
													if(isMod(thisUser.ID)||isEditor(thisUser.ID,thisUser.sitestr)){
														if(thisUser.webvars.dictionary.selected=="" || thisUser.webvars.dictionary.screen == "main"){
															reply("```css\n!Error #0: Nothing selected to edit```");
															break;
														}
														if(typeof args[1] != 'string') args[1] = ""; //don't want anything to break now
														args[2] = condense(args,2);
														switch(thisUser.webvars.dictionary.screen){
															case "roots":
																var holdIndex = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,thisUser.webvars.dictionary.selected);
																if (holdIndex == -1){
																	reply("```css\n!Error #0: Nothing selected to edit; selected item doesn't exist.```");
																	break;
																}
																var holdRoot = thisUser.webvars.dictionary.dicData.roots[holdIndex];
																console.log(holdRoot);
																doRefresh = true;
																switch(args[1].toLowerCase()){
																	case "meaning":
																	case "definition":
																	case "def":
																	case "m":
																	case "d":
																		holdRoot.meaning = args[2];
																	break;
																	case "name":
																	case "n":
																		holdRoot.name = args[2];
																		thisUser.webvars.dictionary.selected = args[2]; //switch the selection reference
																	break;
																	case "pronunciation":
																	case "pronounce":
																	case "p":
																		holdRoot.pronunciation = args[2];
																	break;
																	case "type":
																	case "t":
																		holdRoot.type = args[2];
																	break;
																	case "origin":
																	case "org":
																	case "ori":
																	case "o":
																		holdRoot.origin = args[2];
																	break;
																	default:
																		doRefresh = false;
																		reply("```css\n!Error #6: That field does not exist.```");
																	break;
																}
															break;
															case "words":
																var holdIndex = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,thisUser.webvars.dictionary.selected);
																if (holdIndex == -1){
																	reply("```css\n!Error #0: Nothing selected to edit; selected item doesn't exist.```");
																	break;
																}
																var holdWord = thisUser.webvars.dictionary.dicData.words[holdIndex];
																console.log(holdWord);
																doRefresh = true;
																switch(args[1].toLowerCase()){
																	case "meaning":
																	case "definition":
																	case "def":
																	case "m":
																	case "d":
																		holdWord.definition = args[2];
																	break;
																	case "example":
																	case "ex":
																	case "e":
																		holdWord.example = args[2];
																	break;
																	case "name":
																	case "n":
																		holdWord.name = args[2];
																		thisUser.webvars.dictionary.selected = args[2]; //switch the selection reference
																	break;
																	case "pronunciation":
																	case "pronounce":
																	case "p":
																		holdWord.pronunciation = args[2];
																	break;
																	case "breakdown":
																	case "break":
																	case "bd":
																	case "b":
																		holdWord.breakdown = args[2];
																	break;
																	case "r":
																	case "roots":
																	
																	break;
																	case "origin":
																	case "org":
																	case "ori":
																	case "o":
																		holdWord.origin = args[2];
																	break;
																	default:
																		doRefresh = false;
																		reply("```css\n!Error #6: That field does not exist.```");
																	break;
																}
															break;
														}
													}else{
														reply("```css\n!Error #7: Insufficient privileges.```");
													}
												break;
												case "words":
												case "word":
												case "w":
													thisUser.webvars.dictionary.screen = "words";
													thisUser.webvars.dictionary.selected = condense(args,1);
													doRefresh = true;			
												break;
												case "rootword":
												case "roots":
												case "root":
												case "r":
													thisUser.webvars.dictionary.screen = "roots";
													thisUser.webvars.dictionary.selected = condense(args,1);
													doRefresh = true;									
												break;
												case "replaceroot":
												case "reproot":
												case "rr":
													if(typeof args[2] !== 'string'){
														reply("```css\n!Error #6: Invalid parameter\nThis command requires at least two arguments: [old root] [new root] (new pronunciation)```");
														break;
													}
													var roots = thisUser.webvars.dictionary.dicData.roots;
													var words = thisUser.webvars.dictionary.dicData.words;
													var holdIndex = getArrayIndexByObjectName(roots,args[1]);
													if(holdIndex==-1){
														reply("```css\n!Error #6: Invalid parameter\nRoot '"+args[1]+"' doesn't exist```");
														break;
													}
													if(getArrayIndexByObjectName(roots,args[2])!==-1){
														reply("```!Error #0: Invalid operation\nRoot '"+args[2]+"' already exists```");
														break;
													}
													var foundWords = "";
													var root = roots[holdIndex];
													var word;
													var rootExistsInThisWord;
													root.name = args[1];
													if(typeof args[3] == 'string') root.pronunciation = args[3]; //only update pronunciation if given
													for(var i = 0; i<words.length; i++){
														rootExistsInThisWord = false;
														word = words[i];
														for(var q = 0; q < word.roots.length; q++){
															if(word.roots[q].toLowerCase() == root.name.toLowerCase()){
																rootExistsInThisWord = true;
																word.roots[q] = args[2].toLowerCase();
															}
														}
														if(rootExistsInThisWord){
															foundWords = foundWords + word.name + "\n";
														}
													}
													reply("```css\nChanged words:\n"+foundWords+"```");
													
												break;
												case 'sort':
													sortArrayByObjectName(thisUser.webvars.dictionary.dicData.roots,"a");
													sortArrayByObjectName(thisUser.webvars.dictionary.dicData.words,"a");
												break;
												case 'print':
													var say = "",holdSay;
													say = say+"////////ROOTS////////\n"
													for(var i = 0; i<thisUser.webvars.dictionary.dicData.roots.length; i++){
														var root = thisUser.webvars.dictionary.dicData.roots[i];
														holdSay = ""
														for(var q = 0; q<root.examples.length; q++){
															holdSay = holdSay+"\n   "+root.examples[q]; //compile examples
														}
														say = say+"\n\n\n[ "+root.name+" ] -- (\""+root.pronunciation+"\")\nType: "+root.type+"\n\nMeaning:\n   "+root.meaning+"\n\nOrigin: "+root.origin+"\n\nWords containing this root:"+holdSay;
													}
													say = say+"\n\n////////WORDS////////\n"
													for(var i = 0; i<thisUser.webvars.dictionary.dicData.words.length; i++){
														var word = thisUser.webvars.dictionary.dicData.words[i];
														holdSay = ""
														for(var q = 0; q<word.roots.length; q++){
															holdSay = holdSay+"\n   "+word.roots[q]; //compile roots
														}
														say = say+"\n\n\n[ "+word.name+" ] -- (\""+word.pronunciation+"\")\n\nMeaning:"+("\n"+word.definition).replaceAll("\n","\n    ")+"\n\nBreakdown: "+word.breakdown+"\n\nOrigin: "+word.origin+"\n\nExamples:"+("\n"+word.example).replaceAll("\n","\n    ")+"\n\nRoots:"+holdSay;
													}
													var fileName = thisUser.webvars.dictionary.dicData.langName;
													fs.writeFileSync('./temp/'+fileName+'.txt', say.split("\n").join("\r\n"), (err) => {
														if (err) throw err;
														console.log('temp file saved');
													});
													file("```css\nCompiled, printable dictionary for "+fileName+":```",'./temp/'+fileName+'.txt');
												break;
												case "render":
													doRefresh = true;
												break;
												default:
													if(args[0].indexOf('#')==0){
														doLink = true;
														holdLink = args[0].substring(1);
														break;														
													}else{
														reply("```css\n!Error #4: Unknown command```");
													}
											}
											if(doRefresh){
												var itemIndexInDictionary = -1;
												say = ""; //what to output
												if(web[thisUser.site].pages[thisUser.page].extension!==""){
													say = ".";
												}
												reply2("```css\n"+thisUser.sitestr+":"+thisUser.pagestr+say+web[thisUser.site].pages[thisUser.page].extension+" -- "+web[thisUser.site].pages[thisUser.page].name+'\nCommands:\n "roots" - See a list of this language\'s root words\n "root [root word]" - look at the definition of a specific root word (Ex: "root ka")\n "words" - See a list of this language\'s words\n "word [word]" - look at the definition of a specific word (Ex: "word apple")```');
												say = "";
												switch(thisUser.webvars.dictionary.screen.toLowerCase()){
													case 'main':
														say = "["+thisUser.webvars.dictionary.dicData.langName+" Dictionary]\n\n"+thisUser.webvars.dictionary.dicData.splashPageText;
													break;
													case 'roots':
														if(thisUser.webvars.dictionary.selected==""){
															say = "";
															for(var i = 16*thisUser.webvars.dictionary.page; i < thisUser.webvars.dictionary.page*16+16 && i<thisUser.webvars.dictionary.dicData.roots.length; i++){
																say = say+"  "+thisUser.webvars.dictionary.dicData.roots[i].name+" ("+thisUser.webvars.dictionary.dicData.roots[i].type+") -- "+thisUser.webvars.dictionary.dicData.roots[i].meaning+"\n";
															}
															say = say+"\n[Page "+(thisUser.webvars.dictionary.page+1)+" of "+numRootPages+"]";
														}else{
															itemIndexInDictionary = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.roots,thisUser.webvars.dictionary.selected); //get index of the word
															console.log(itemIndexInDictionary);
															if(itemIndexInDictionary!==-1){
																var root = thisUser.webvars.dictionary.dicData.roots[itemIndexInDictionary];
																say = ""
																for(var i = 0; i<root.examples.length; i++){
																	say = say+"\n   "+root.examples[i]; //compile examples
																}
																say = "[ "+root.name+" ] -- (\""+root.pronunciation+"\")\nType: "+root.type+"\n\nMeaning:\n   "+root.meaning+"\n\nOrigin: "+root.origin+"\n\nWords containing this root:"+say;
															}else{
																say = "Could not find root word \""+thisUser.webvars.dictionary.selected+"\"\nMake sure you spelled it correctly, and try again.";
															}
														}
													break;
													case 'words':
														if(thisUser.webvars.dictionary.selected==""){
															say = "";
															for(var i = 8*thisUser.webvars.dictionary.page; i < thisUser.webvars.dictionary.page*8+8 && i<thisUser.webvars.dictionary.dicData.words.length; i++){
																say = say+"  [  "+thisUser.webvars.dictionary.dicData.words[i].name+"  ]"+("\n"+thisUser.webvars.dictionary.dicData.words[i].definition).replaceAll("\n","\n    ")+"\n";
															}
															say = say+"\n[Page "+(thisUser.webvars.dictionary.page+1)+" of "+numWordPages+"]";
														}else{
															itemIndexInDictionary = getArrayIndexByObjectName(thisUser.webvars.dictionary.dicData.words,thisUser.webvars.dictionary.selected); //get index of the word
															console.log(itemIndexInDictionary);
															if(itemIndexInDictionary!==-1){
																var word = thisUser.webvars.dictionary.dicData.words[itemIndexInDictionary];
																say = ""
																for(var i = 0; i<word.roots.length; i++){
																	say = say+"\n   "+word.roots[i]; //compile roots
																}
																say = "[ "+word.name+" ] -- (\""+word.pronunciation+"\")\n\nMeaning:"+("\n"+word.definition).replaceAll("\n","\n    ")+"\n\nBreakdown: "+word.breakdown+"\n\nOrigin: "+word.origin+"\n\nExamples:"+("\n"+word.example).replaceAll("\n","\n    ")+"\n\nRoots:"+say;
															}else{
																say = "Could not find word \""+thisUser.webvars.dictionary.selected+"\"\nMake sure you spelled it correctly, and try again.";
															}
														}
													break;
													default:
														//should be unreachable
														reply(thisUser.webvars.dictionary.screen+" -- how did we get here?");
													break;
												}
												reply("```css\n"+say+"```"); //output
											}
										break;
									}
								}else{
									reply("```css\n!Error #4: Unknown command```");
								}
							case 'null':
							break;
						}
					} while(loopover);
				}
				$("#entryNum").html(getNumWikiEntries()+$("#entryNum").html()); //display num entries
				var holdURL = window.location.href;
				console.log(holdURL);
				var holdLink = urlParams.get('link');
				var holdDom = urlParams.get('dom');
				
				var nextCommand = "";
				if((holdLink !== "" && typeof holdLink == 'string') || (holdDom !== "" && typeof holdDom == 'string')){
					console.log(holdLink);
					console.log(holdDom);
					if(holdDom !== "" && typeof holdDom == 'string') linkDomain = holdDom;
					if(holdLink !== "" && typeof holdLink == 'string'){
						nextCommand = holdLink;
						console.log(holdLink);
					}
				}else if(holdURL.indexOf("?")!==-1){
					holdURL = atob(holdURL.split("?")[1]);
					nextCommand = holdURL;
					console.log(holdURL);
				}
				runCommand(nextCommand);
				
			});
		</script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>
